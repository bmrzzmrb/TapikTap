<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–¢–∞–ø–∞–π —è–π—Ü–∞ –¥–æ–ª–±–∞–µ–±</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
    background: radial-gradient(circle, #2b0000 0%, #000 100%);
    color: white;
    font-family: 'Times New Roman', Roboto, sans-serif;
    text-align: center;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    user-select: none;
}

.stats-container {
    margin-top: 20px;
    background: rgba(255,0,0,0.1);
    padding: 15px;
    border-radius: 20px;
    width: 85%;
}

.stats { font-size: 22px; font-weight: bold; }

.nav-tabs {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.tab-btn {
    padding: 10px 25px;
    border-radius: 12px;
    border: 1px solid #ff0000;
    background: #1a0000;
    color: white;
    cursor: pointer;
}

.tab-btn.active { background: #ff0000; }

.screen {
    display: none;
    width: 100%;
    align-items: center;
    flex-direction: column;
}

.active-screen { display: flex; }

#coin, #boss-img {
    width: 220px;
    height: 220px;
    border-radius: 50%;
    border: 4px solid #ff0000;
    box-shadow: 0 0 30px #ff0000;
    cursor: pointer;
    object-fit: cover;
}

.grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    width: 90%;
    max-width: 400px;
    margin-top: 20px;
}

.neon-btn {
    background: linear-gradient(135deg, #ff0000, #8b0000);
    border: none;
    border-radius: 12px;
    color: white;
    padding: 12px;
    font-weight: bold;
    cursor: pointer;
}

.boss-card {
    background: rgba(60,0,0,0.5);
    border-radius: 15px;
    padding: 15px;
    margin: 10px;
    width: 85%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    text-align: left;
}

.boss-info small {
    display: block;
    opacity: 0.85;
}

.hp-container {
    width: 80%;
    height: 25px;
    background: #220000;
    border-radius: 12px;
    overflow: hidden;
    margin: 10px 0;
}

#hp-bar {
    height: 100%;
    background: linear-gradient(90deg, red, pink);
}

#timer {
    font-size: 20px;
    margin-top: 10px;
    color: #ffaaaa;
}
</style>
</head>

<body>

<div class="stats-container">
    <div class="stats">–ù–∞—Ç—ã–∫–∞–ª(–∞) –ø–æ —è–π—Ü–∞–º: <span id="balance">0</span></div>
    <div class="stats">‚ö° –°–∏–ª–∞ –∫–ª–∏–∫–∞: <span id="clickLvl">1</span></div>

    <div class="nav-tabs">
        <button class="tab-btn active" onclick="showScreen('main', this)">–ì–õ–ê–í–ù–ê–Ø</button>
        <button class="tab-btn" onclick="showScreen('boss-list', this)">–ë–û–°–°–´</button>
    </div>
</div>

<!-- –ì–õ–ê–í–ù–ê–Ø -->
<div id="main" class="screen active-screen">
    <img id="coin" src="https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/andrey.png" onclick="clickCoin()">
    <div class="grid">
        <button class="neon-btn" onclick="upgradeClick()">
            –£–õ–£–ß–®–ò–¢–¨ –°–ò–õ–£<br>
            <small>–¶–µ–Ω–∞: <span id="upgradeCost">10</span></small>
        </button>
        <button class="neon-btn" onclick="saveGame()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
    </div>
</div>

<div id="boss-list" class="screen">

    <!-- –•–û–î–ò–õ–ö–ê –ë–†–û–î–ò–õ–ö–ê (–°–ê–ú–´–ô –ü–ï–†–í–´–ô) -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–•–æ–¥–∏–ª–∫–∞ –±—Ä–æ–¥–∏–ª–∫–∞</b>
            <small>HP: 300 000</small>
            <small>–í—Ö–æ–¥: 1 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 15 000</small>
            <small>–ü–æ—è–≤–ª—è–µ—Ç—Å—è –≤–Ω–µ–∑–∞–ø–Ω–æ. –£—Ö–æ–¥–∏—Ç –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–•–æ–¥–∏–ª–∫–∞ –±—Ä–æ–¥–∏–ª–∫–∞',300000,15000,1000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/hodilkabrodilka.jpg'
        )">–í –ë–û–ô</button>
    </div>

    <!-- –ú–ï–†–°–ï–î–ï–° -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–ú–µ—Ä—Å–µ–¥–µ—Å</b>
            <small>HP: 600</small>
            <small>–í—Ö–æ–¥: 3 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 15 000</small>
            <small>–£—á–∏—Ç–µ–ª—å-–∫–∞—Ä–∞—Ç–µ–ª—å. –ó–≤–æ–Ω–æ–∫ –¥–ª—è –Ω–µ—ë ‚Äî –Ω–µ –∑–∞–∫–æ–Ω.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ú–µ—Ä—Å–µ–¥–µ—Å',600,15000,3000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/mersedes.jpg'
        )">–í –ë–û–ô</button>
    </div>

    <!-- –§–ò–ó–ò–ö -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–§–∏–∑–∏–∫</b>
            <small>HP: 1 200</small>
            <small>–í—Ö–æ–¥: 8 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 30 000</small>
            <small>–ó–∞—Å—Ç–∞–≤–∏—Ç —Å—Ç—Ä–∞–¥–∞—Ç—å –¥–∞–∂–µ –æ—Ç–ª–∏—á–Ω–∏–∫–æ–≤.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–§–∏–∑–∏–∫',1200,30000,8000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/fizik.jpg'
        )">–í –ë–û–ô</button>
    </div>

    <!-- –ê–ì–ê–ê–ê–ê–ê -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–ê–≥–∞–∞–∞–∞–∞–∞</b>
            <small>HP: 2 000</small>
            <small>–í—Ö–æ–¥: 5 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 12 000</small>
            <small>–û—Ä —Å–ª—ã—à–µ–Ω –∑–∞ —Ç—Ä–∏ —Ä–∞–π–æ–Ω–∞.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ê–≥–∞–∞–∞–∞–∞–∞',2000,12000,5000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/agaaa.jpg'
        )">–í –ë–û–ô</button>
    </div>

    <!-- –ò–°–¢–û–†–ò–ö -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–ò–∏—Å—Ç–æ–æ–æ–æ—Ä–∏–∏–∏–∫</b>
            <small>HP: 250000</small>
            <small>–í—Ö–æ–¥: 30 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 250 000</small>
            <small>–§–∞ –§–∞ –§–∞ —à–Ω–µ–π–Ω–µ –≤–∞—Ç–∞—Ñ–∞.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ò–∏—Å—Ç–æ–æ–æ–æ—Ä–∏–∏–∏–∫',250000,250000,30000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/istorik.jpg'
        )">–í –ë–û–ô</button>
    </div>

    <!-- –ñ–ê–ù–ù–ê –ö–ò–°–ö–ê -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–ñ–∞–Ω–Ω–∞ –ö–∏—Å–∫–∞</b>
            <small>HP: 100000</small>
            <small>–í—Ö–æ–¥: 60 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 500 000</small>
            <small>–ú–æ—Ä–∞–ª—å–Ω—ã–π —É—Ä–æ–Ω x10.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ñ–∞–Ω–Ω–∞ –ö–∏—Å–∫–∞',100000,500000,60000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/jannakiska.jpg'
        )">–í –ë–û–ô</button>
    </div>

    <!-- –ú–û–•-–ò–†–ï–í–ê -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–ú–æ—Ö-–ò—Ä–µ–≤–∞</b>
            <small>HP: 100 000</small>
            <small>–í—Ö–æ–¥: 120 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 1 000 000</small>
            <small>–ë—å—ë—Ç —Å–ª–æ–≤–æ–º —Å–∏–ª—å–Ω–µ–µ –∫—É–ª–∞–∫–∞.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ú–æ—Ö-–ò—Ä–µ–≤–∞',100000,1000000,120000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/moxireva.jpg'
        )">–í –ë–û–ô</button>
    </div>

    <!-- –î–ò–ö–ê–Ø –¢–†–û–ò–¶–ê -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–î–∏–∫–∞—è —Ç—Ä–æ–∏—Ü–∞</b>
            <small>HP: 200 000</small>
            <small>–í—Ö–æ–¥: 250 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 750 000</small>
            <small>–ë—å—é—Ç –≤—Ç—Ä–æ—ë–º. –î—É–º–∞—é—Ç –Ω–æ–ª—å —Å–µ–∫—É–Ω–¥.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–î–∏–∫–∞—è —Ç—Ä–æ–∏—Ü–∞',200000,750000,250000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/troica.jpg'
        )">–í –ë–û–ô</button>
    </div>

    <!-- –ú–ò–®–£–ö -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–ú–∏—à—É–∫</b>
            <small>HP: 150 000</small>
            <small>–í—Ö–æ–¥: 500 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 2 000 000</small>
            <small>–ü–æ–º–Ω–∏—Ç –æ—Ü–µ–Ω–∫–∏. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–±—ã–≤–∞–µ—Ç.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ú–∏—à—É–∫',150000,2000000,500000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/mishyk.jpg'
        )">–í –ë–û–ô</button>
    </div>

    <!-- –ß–û–ü–û–† (–§–ò–ù–ê–õ / –°–¢–†–ê–®–ù–´–ô) -->
    <div class="boss-card">
        <div class="boss-info">
            <b>–ß–û–ü–û–†</b>
            <small>HP: 300 000 000</small>
            <small>–í—Ö–æ–¥: 50 000 000</small>
            <small>–ù–∞–≥—Ä–∞–¥–∞: 100 000 000</small>
            <small>11 –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ. –ú–Ø–Ø–Ø–Ø–Ø–ß –°–Æ–î–ê–ê–ê–ê–ê–ê.</small>
        </div>
        <button class="neon-btn" onclick="startBossFight(
            '–ß–û–ü–û–†',300000000,100000000,50000000,
            'https://raw.githubusercontent.com/bmrzzmrb/TapikTap/main/chopor.jpg'
        )">–í –ë–û–ô</button>
    </div>

</div>

<!-- –≠–ö–†–ê–ù –ë–û–Ø -->
<div id="boss-battle" class="screen">
    <h2 id="boss-name">–ë–û–°–°</h2>
    <div id="timer">‚è±Ô∏è 60</div>
    <div class="hp-container"><div id="hp-bar"></div></div>
    <img id="boss-img" onclick="hitBoss()">
</div>

<script>
let tg = window.Telegram.WebApp;
tg.expand();

// –í–∏–±—Ä–∞—Ü–∏—è
function vibrate(type = 'light') {
    if (tg && tg.HapticFeedback) {
        if (type === 'light') tg.HapticFeedback.impactOccurred('light');
        if (type === 'medium') tg.HapticFeedback.impactOccurred('medium');
        if (type === 'heavy') tg.HapticFeedback.impactOccurred('heavy');
    }
    if (navigator.vibrate) {
        navigator.vibrate(type === 'light' ? 10 : 30);
    }
}

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let balance = 0;
let clickPower = 1;
let upgradeCost = 10;

let bossHp = 0, bossMaxHp = 0, bossReward = 0;
let fightTimer = null;
let timeLeft = 60;

// ------------------- LocalStorage -------------------
function saveLocal() {
    localStorage.setItem('tapGame', JSON.stringify({
        balance,
        clickPower,
        upgradeCost
    }));
}

function loadLocal() {
    const data = localStorage.getItem('tapGame');
    if (data) {
        try {
            const parsed = JSON.parse(data);
            balance = parsed.balance || 0;
            clickPower = parsed.clickPower || 1;
            upgradeCost = parsed.upgradeCost || 10;
        } catch(e) {}
    }
}

// ------------------- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã -------------------
async function loadGame() {
    // –°–Ω–∞—á–∞–ª–∞ localStorage
    loadLocal();
    updateUI();

    // –ü–æ—Ç–æ–º Telegram Cloud (–µ—Å–ª–∏ –µ—Å—Ç—å)
    if (tg.isVersionAtLeast('6.9')) {
        tg.CloudStorage.getItems(['balance','power','cost'], (err, values) => {
            if (!err && values) {
                if (values.balance) balance = parseInt(values.balance);
                if (values.power) clickPower = parseInt(values.power);
                if (values.cost) upgradeCost = parseInt(values.cost);
                updateUI();
                saveLocal(); // —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å local
            }
        });
    }
}

// ------------------- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã -------------------
function saveGame(silent = false) {
    saveLocal(); // –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage

    if (tg.isVersionAtLeast('6.9')) {
        tg.CloudStorage.setItem('balance', balance.toString());
        tg.CloudStorage.setItem('power', clickPower.toString());
        tg.CloudStorage.setItem('cost', upgradeCost.toString(), () => {
            if (!silent) tg.showAlert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
        });
    } else {
        if (!silent) tg.showAlert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ!');
    }
}

// ------------------- UI -------------------
function updateUI() {
    document.getElementById('balance').innerText = balance;
    document.getElementById('clickLvl').innerText = clickPower;
    document.getElementById('upgradeCost').innerText = upgradeCost;
}

function showScreen(id, btn) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
    document.getElementById(id).classList.add('active-screen');
    if (btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
}

// ------------------- –ö–ª–∏–∫ –ø–æ —è–π—Ü—É -------------------
function clickCoin() {
    balance += clickPower;
    vibrate('light');
    updateUI();
    saveGame(true);

    const img = document.getElementById('coin');
    img.style.transform = 'scale(0.95)';
    setTimeout(() => img.style.transform = 'scale(1)', 50);
}

// ------------------- –£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞ -------------------
function upgradeClick() {
    if (balance >= upgradeCost) {
        balance -= upgradeCost;
        clickPower++;
        upgradeCost = Math.round(upgradeCost * 1.5);
        vibrate('medium');
        updateUI();
        saveGame(true);
    } else {
        vibrate('heavy');
        tg.showAlert('–ú–∞–ª–æ —è–∏—Ü!');
    }
}

// ------------------- –ë–æ—Å—Å -------------------
function startBossFight(name, hp, reward, cost, img) {
    if (balance < cost) return tg.showAlert('–ù—É–∂–Ω–æ ' + cost + ' –º–æ–Ω–µ—Ç!');
    balance -= cost;
    updateUI();

    bossHp = bossMaxHp = hp;
    bossReward = reward;
    timeLeft = 30;

    document.getElementById('boss-name').innerText = name;
    document.getElementById('boss-img').src = img;
    document.getElementById('hp-bar').style.width = '100%';
    
    document.querySelector('.nav-tabs').style.display = 'none';
    showScreen('boss-battle');
    
    clearInterval(fightTimer);
    fightTimer = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').innerText = '‚è±Ô∏è ' + timeLeft;
        if (timeLeft <= 0) {
            clearInterval(fightTimer);
            tg.showAlert('–í–†–ï–ú–Ø –í–´–®–õ–û! üíÄ');
            endFight();
        }
    }, 1000);
}

function hitBoss() {
    bossHp -= clickPower;
    vibrate('light');
    document.getElementById('hp-bar').style.width = (bossHp / bossMaxHp * 100) + '%';
    
    if (bossHp <= 0) {
        clearInterval(fightTimer);
        balance += bossReward;
        vibrate('heavy');
        saveGame(true);
        tg.showAlert('–ü–û–ë–ï–î–ê! +' + bossReward);
        endFight();
    }
}

function endFight() {
    document.querySelector('.nav-tabs').style.display = 'flex';
    updateUI();
    showScreen('main', document.querySelectorAll('.tab-btn')[0]);
}

// ------------------- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ -------------------
setInterval(() => saveGame(true), 30000);

// ------------------- –°—Ç–∞—Ä—Ç -------------------
loadGame();
</script>
