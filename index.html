<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TapikTap</title>

<!-- Telegram WebApp SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at top, #ff2a2a, #6a0000);
    font-family: Arial, sans-serif;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    user-select: none;
}

.stats {
    text-align: center;
    font-size: 22px;
    margin-bottom: 15px;
}

#coin {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: #ffd700;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 70px;
    box-shadow: 0 0 30px rgba(255, 50, 50, 0.9);
    transition: transform 0.08s;
}

#coin:active {
    transform: scale(0.9);
}

button {
    margin-top: 10px;
    padding: 12px 22px;
    font-size: 18px;
    border: none;
    border-radius: 14px;
    background: linear-gradient(45deg, #ff3b3b, #ff8800);
    color: #fff;
    box-shadow: 0 0 15px rgba(255, 100, 100, 0.8);
}
</style>
</head>

<body>

<div class="stats">
    <div>üí∞ –ë–∞–ª–∞–Ω—Å: <span id="balance">0</span></div>
    <div>‚ö° –°–∏–ª–∞ –∫–ª–∏–∫–∞: <span id="power">1</span></div>
    <div>üîº –¶–µ–Ω–∞ –∞–ø–≥—Ä–µ–π–¥–∞: <span id="cost">10</span></div>
</div>

<div id="coin">ü™ô</div>

<button onclick="upgrade()">–ê–ø–≥—Ä–µ–π–¥</button>

<script>
/* -------- TELEGRAM INIT -------- */
let tg = window.Telegram?.WebApp;
tg?.ready();
tg?.expand();

/* -------- SERVER URL -------- */
const SERVER = "http://31.23.234.141:8000";

/* -------- USER -------- */
const userId = Telegram.WebApp.initDataUnsafe.user.id;

/* -------- GAME STATE -------- */
let balance = 0;
let power = 1;
let cost = 10;

const balanceEl = document.getElementById("balance");
const powerEl = document.getElementById("power");
const costEl = document.getElementById("cost");
const coin = document.getElementById("coin");

/* -------- LOAD USER -------- */
fetch(`${SERVER}/click`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ user_id: userId })
})
.then(r => r.json())
.then(data => {
    balance = data.balance;
    power = data.power;
    cost = power * 10;
    updateUI();
});

/* -------- CLICK -------- */
coin.addEventListener("pointerdown", () => {
    fetch(`${SERVER}/click`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ user_id: userId })
    })
    .then(r => r.json())
    .then(data => {
        balance = data.balance;
        power = data.power;
        cost = power * 10;
        updateUI();
        tg?.HapticFeedback?.impactOccurred("medium");
    });
});

/* -------- UPGRADE -------- */
function upgrade() {
    fetch(`${SERVER}/upgrade`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ user_id: userId })
    })
    .then(r => r.json())
    .then(data => {
        if (!data.error) {
            balance = data.balance;
            power = data.power;
            cost = power * 10;
            updateUI();
        }
    });
}

function updateUI() {
    balanceEl.innerText = balance;
    powerEl.innerText = power;
    costEl.innerText = cost;
}
</script>

</body>
</html>
